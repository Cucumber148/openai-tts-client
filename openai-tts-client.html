<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAI TTS Client</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 1.1em;
        }

        input[type="password"], textarea, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        input[type="password"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.5;
        }

        .row {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .row .form-group {
            flex: 1;
        }

        .switch-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #667eea;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .speed-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: #e1e5e9;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .speed-value {
            font-weight: 600;
            color: #667eea;
            min-width: 50px;
            text-align: center;
        }

        .generate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .loading-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #667eea;
            font-weight: 600;
            font-size: 16px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(45deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .loading-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: #6c757d;
        }

        .loading-status {
            font-weight: 500;
        }

        .loading-details {
            text-align: right;
            font-size: 12px;
        }

        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            display: none;
        }

        .result h3 {
            color: #333;
            margin-bottom: 15px;
        }

        audio {
            width: 100%;
            margin-bottom: 15px;
        }

        .download-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .download-btn:hover {
            background: #218838;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #dc3545;
            display: none;
        }

        .model-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #1976d2;
        }

        .voice-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .voice-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ OpenAI TTS</h1>
        
        <div class="model-info">
            <strong>üí° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥–µ–ª—è—Ö:</strong><br>
            <strong>gpt-4o-mini-tts:</strong> –ù–æ–≤–µ–π—à–∞—è –º–æ–¥–µ–ª—å —Å —É–ø—Ä–∞–≤–ª—è–µ–º–æ–π —Ä–µ—á—å—é –∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏<br>
            <strong>tts-1:</strong> –ë—ã—Å—Ç—Ä–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è, —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ<br>
            <strong>tts-1-hd:</strong> –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞
        </div>

        <form id="ttsForm">
            <div class="form-group">
                <label for="apiKey">üîë OpenAI API Key</label>
                <input type="password" id="apiKey" placeholder="sk-..." required>
            </div>

            <div class="form-group">
                <label for="model">ü§ñ –ú–æ–¥–µ–ª—å TTS</label>
                <select id="model" required>
                    <option value="">–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="text">üìù –¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∏–≤–∞–Ω–∏—è</label>
                <textarea id="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤ —Ä–µ—á—å..." required></textarea>
            </div>

            <div class="form-group">
                <label for="instructions">üé≠ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–µ—á–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è gpt-4o-mini-tts)</label>
                <textarea id="instructions" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ì–æ–≤–æ—Ä–∏ –≤–µ—Å–µ–ª–æ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π –±—Ä–∏—Ç–∞–Ω—Å–∫–∏–π –∞–∫—Ü–µ–Ω—Ç." rows="2"></textarea>
                <small style="color: #666; font-size: 12px;">–ú–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å: –∞–∫—Ü–µ–Ω—Ç–æ–º, —ç–º–æ—Ü–∏—è–º–∏, –∏–Ω—Ç–æ–Ω–∞—Ü–∏–µ–π, —Å–∫–æ—Ä–æ—Å—Ç—å—é, —Ç–æ–Ω–æ–º</small>
            </div>

            <div class="row">
                <div class="form-group">
                    <label for="voice">üó£Ô∏è –ì–æ–ª–æ—Å</label>
                    <select id="voice" required>
                        <option value="alloy">Alloy</option>
                        <option value="ash">Ash (–Ω–æ–≤—ã–π)</option>
                        <option value="ballad">Ballad (–Ω–æ–≤—ã–π)</option>
                        <option value="coral">Coral (–Ω–æ–≤—ã–π)</option>
                        <option value="echo">Echo</option>
                        <option value="fable">Fable</option>
                        <option value="nova">Nova</option>
                        <option value="onyx">Onyx</option>
                        <option value="sage">Sage (–Ω–æ–≤—ã–π)</option>
                        <option value="shimmer">Shimmer</option>
                    </select>
                    <div class="voice-preview">
                        <span class="voice-tag">11 –≥–æ–ª–æ—Å–æ–≤</span>
                        <span class="voice-tag">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</span>
                        <span class="voice-tag">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞ OpenAI.fm</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="format">üéß –§–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ</label>
                    <select id="format">
                        <option value="mp3">MP3 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                        <option value="opus">Opus (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)</option>
                        <option value="aac">AAC (YouTube, –º–æ–±–∏–ª—å–Ω—ã–µ)</option>
                        <option value="flac">FLAC (–±–µ–∑ –ø–æ—Ç–µ—Ä—å)</option>
                        <option value="wav">WAV (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)</option>
                        <option value="pcm">PCM (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="speed">‚ö° –°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ—á–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π)</label>
                <div class="speed-container">
                    <span>0.25x</span>
                    <input type="range" id="speed" min="0.25" max="4.0" step="0.05" value="1.0">
                    <span>4.0x</span>
                    <div class="speed-value">1.0x</div>
                </div>
                <small style="color: #666; font-size: 12px;">–î–ª—è gpt-4o-mini-tts –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã—à–µ</small>
            </div>

            <div class="form-group">
                <label for="format">üéß –§–æ—Ä–º–∞—Ç –∞—É–¥–∏–æ</label>
                <select id="format">
                    <option value="mp3">MP3 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                    <option value="opus">Opus (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)</option>
                    <option value="aac">AAC (YouTube, –º–æ–±–∏–ª—å–Ω—ã–µ)</option>
                    <option value="flac">FLAC (–±–µ–∑ –ø–æ—Ç–µ—Ä—å)</option>
                    <option value="wav">WAV (–Ω–∏–∑–∫–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)</option>
                    <option value="pcm">PCM (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ)</option>
                </select>
            </div>

            <button type="submit" class="generate-btn" id="generateBtn">
                üé§ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—á—å
            </button>
        </form>

        <div class="loading" id="loading">
            <div class="loading-header">
                <div class="spinner"></div>
                <span id="loadingTitle">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...</span>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="loading-info">
                <div class="loading-status" id="loadingStatus">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
                <div class="loading-details" id="loadingDetails">0%</div>
            </div>
        </div>

        <div class="error" id="error"></div>

        <div class="result" id="result">
            <h3>‚úÖ –ê—É–¥–∏–æ –≥–æ—Ç–æ–≤–æ!</h3>
            <audio controls id="audioPlayer"></audio>
            <br>
            <a href="#" class="download-btn" id="downloadBtn">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ</a>
        </div>
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        const speedSlider = document.getElementById('speed');
        const speedValue = document.querySelector('.speed-value');
        
        speedSlider.addEventListener('input', (e) => {
            speedValue.textContent = e.target.value + 'x';
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
        async function loadModels() {
            const apiKey = document.getElementById('apiKey').value;
            const modelSelect = document.getElementById('model');
            
            if (!apiKey) {
                modelSelect.innerHTML = '<option value="">–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π</option>';
                return;
            }

            try {
                modelSelect.innerHTML = '<option value="">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...</option>';
                
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                    }
                });

                if (!response.ok) {
                    throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª–∏');
                }

                const data = await response.json();
                const ttsModels = data.data.filter(model => 
                    model.id.includes('tts') && 
                    !model.id.includes('whisper')
                ).sort((a, b) => {
                    // –°–æ—Ä—Ç–∏—Ä—É–µ–º: —Å–Ω–∞—á–∞–ª–∞ gpt-4o-mini-tts, –ø–æ—Ç–æ–º tts-1-hd, –ø–æ—Ç–æ–º tts-1
                    if (a.id.includes('gpt-4o-mini-tts')) return -1;
                    if (b.id.includes('gpt-4o-mini-tts')) return 1;
                    if (a.id.includes('tts-1-hd')) return -1;
                    if (b.id.includes('tts-1-hd')) return 1;
                    return a.id.localeCompare(b.id);
                });

                modelSelect.innerHTML = '';
                
                if (ttsModels.length === 0) {
                    modelSelect.innerHTML = '<option value="">‚ùå TTS –º–æ–¥–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</option>';
                    return;
                }

                ttsModels.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.id;
                    
                    let description = '';
                    if (model.id.includes('gpt-4o-mini-tts')) {
                        description = ' (üÜï –ù–æ–≤–µ–π—à–∞—è —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏)';
                    } else if (model.id.includes('tts-1-hd')) {
                        description = ' (HD –∫–∞—á–µ—Å—Ç–≤–æ)';
                    } else if (model.id.includes('tts-1')) {
                        description = ' (–ë—ã—Å—Ç—Ä–∞—è)';
                    }
                    
                    option.textContent = model.id + description;
                    modelSelect.appendChild(option);
                });

                // –í—ã–±–∏—Ä–∞–µ–º gpt-4o-mini-tts –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞
                const defaultModel = ttsModels.find(m => m.id.includes('gpt-4o-mini-tts'));
                if (defaultModel) {
                    modelSelect.value = defaultModel.id;
                    updateUIForModel(defaultModel.id);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π:', error);
                modelSelect.innerHTML = '<option value="">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–µ–π</option>';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
        function updateUIForModel(modelId) {
            const instructionsGroup = document.getElementById('instructions').closest('.form-group');
            const speedGroup = document.getElementById('speed').closest('.form-group');
            
            if (modelId.includes('gpt-4o-mini-tts')) {
                // –î–ª—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∫—Ä—ã–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
                instructionsGroup.style.display = 'block';
                speedGroup.style.display = 'none';
            } else {
                // –î–ª—è —Å—Ç–∞—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
                instructionsGroup.style.display = 'none';
                speedGroup.style.display = 'block';
            }
        }
        function updateProgress(percentage, status, details = '') {
            const progressBar = document.getElementById('progressBar');
            const loadingStatus = document.getElementById('loadingStatus');
            const loadingDetails = document.getElementById('loadingDetails');
            const loadingTitle = document.getElementById('loadingTitle');
            
            progressBar.style.width = percentage + '%';
            loadingStatus.textContent = status;
            loadingDetails.textContent = percentage + '%';
            
            if (percentage < 30) {
                loadingTitle.textContent = 'üîÑ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞...';
            } else if (percentage < 70) {
                loadingTitle.textContent = 'üé§ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞—É–¥–∏–æ...';
            } else {
                loadingTitle.textContent = '‚úÖ –ó–∞–≤–µ—Ä—à–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É...';
            }
            
            if (details) {
                loadingDetails.textContent += ` ‚Ä¢ ${details}`;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Ç–∞–∫ –∫–∞–∫ OpenAI API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å)
        function simulateProgress() {
            return new Promise((resolve) => {
                let progress = 0;
                const interval = setInterval(() => {
                    progress += Math.random() * 15 + 5; // –°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏—Ä–æ—Å—Ç 5-20%
                    
                    if (progress < 30) {
                        updateProgress(Math.min(progress, 25), '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ OpenAI API...');
                    } else if (progress < 60) {
                        updateProgress(Math.min(progress, 55), '–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç—å—é...');
                    } else if (progress < 85) {
                        updateProgress(Math.min(progress, 80), '–°–∏–Ω—Ç–µ–∑ –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞...');
                    } else {
                        updateProgress(90, '–ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...');
                        clearInterval(interval);
                        resolve();
                    }
                }, 200 + Math.random() * 300); // –°–ª—É—á–∞–π–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª 200-500–º—Å
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('ttsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const apiKey = document.getElementById('apiKey').value;
            const model = document.getElementById('model').value;
            const text = document.getElementById('text').value;
            const voice = document.getElementById('voice').value;
            const instructions = document.getElementById('instructions').value;
            const speed = parseFloat(document.getElementById('speed').value);
            const format = document.getElementById('format').value;
            
            // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
            if (!model) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å TTS');
                return;
            }
            
            if (text.length > 4096) {
                showError('–¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π! –ú–∞–∫—Å–∏–º—É–º 4096 —Å–∏–º–≤–æ–ª–æ–≤.');
                return;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            document.getElementById('result').style.display = 'none';
            document.getElementById('error').style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            document.getElementById('loading').style.display = 'block';
            document.getElementById('generateBtn').disabled = true;
            
            // –ù–∞—á–∏–Ω–∞–µ–º —Å–∏–º—É–ª—è—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            updateProgress(0, '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...', `${text.length} —Å–∏–º–≤–æ–ª–æ–≤`);
            
            const progressPromise = simulateProgress();
            
            try {
                const requestData = {
                    model: model,
                    input: text,
                    voice: voice,
                    response_format: format
                };

                // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏
                if (model.includes('gpt-4o-mini-tts')) {
                    if (instructions.trim()) {
                        requestData.instructions = instructions.trim();
                    }
                } else {
                    // –î–ª—è —Å—Ç–∞—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π –¥–æ–±–∞–≤–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
                    requestData.speed = speed;
                }

                console.log('üöÄ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ OpenAI:', requestData);
                updateProgress(15, '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenAI API...', `–ú–æ–¥–µ–ª—å: ${model}`);

                const response = await fetch('https://api.openai.com/v1/audio/speech', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                console.log('üì° –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç API:', response.status, response.statusText);

                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.error?.message || errorMessage;
                        console.error('‚ùå –û—à–∏–±–∫–∞ API:', errorData);
                    } catch (e) {
                        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ—à–∏–±–∫—É:', e);
                    }
                    throw new Error(errorMessage);
                }

                updateProgress(70, '–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö...', `–§–æ—Ä–º–∞—Ç: ${format.toUpperCase()}`);

                const audioBlob = await response.blob();
                console.log('üéµ –ü–æ–ª—É—á–µ–Ω–æ –∞—É–¥–∏–æ:', audioBlob.size, '–±–∞–π—Ç');

                // –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
                await progressPromise;
                updateProgress(100, '–ì–æ—Ç–æ–≤–æ!', `${(audioBlob.size / 1024).toFixed(1)} –ö–ë`);

                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞ 100%
                await new Promise(resolve => setTimeout(resolve, 500));

                const audioUrl = URL.createObjectURL(audioBlob);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const audioPlayer = document.getElementById('audioPlayer');
                const downloadBtn = document.getElementById('downloadBtn');
                const resultDiv = document.getElementById('result');
                
                audioPlayer.src = audioUrl;
                downloadBtn.href = audioUrl;
                downloadBtn.download = `tts_${voice}_${Date.now()}.${format}`;
                
                resultDiv.style.display = 'block';
                resultDiv.classList.add('success-animation');
                
                console.log('‚úÖ –ê—É–¥–∏–æ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ!');
                
            } catch (error) {
                console.error('üí• –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:', error);
                showError(error.message);
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('loading').style.display = 'none';
                document.getElementById('generateBtn').disabled = false;
            }
        });

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—à–∏–±–æ–∫
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = `<strong>‚ùå –û—à–∏–±–∫–∞:</strong> ${message}`;
            errorDiv.style.display = 'block';
            console.error('üö® –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:', message);
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ API –∫–ª—é—á–∞ –≤ localStorage –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞)
        const apiKeyInput = document.getElementById('apiKey');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–ª—é—á
        const savedKey = localStorage.getItem('openai_api_key');
        if (savedKey) {
            apiKeyInput.value = savedKey;
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª–∏ –µ—Å–ª–∏ –∫–ª—é—á –µ—Å—Ç—å
            loadModels();
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ
        apiKeyInput.addEventListener('blur', () => {
            if (apiKeyInput.value) {
                localStorage.setItem('openai_api_key', apiKeyInput.value);
                loadModels();
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø—Ä–∏ —Å–º–µ–Ω–µ –º–æ–¥–µ–ª–∏
        document.getElementById('model').addEventListener('change', (e) => {
            updateUIForModel(e.target.value);
        });

        // –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
        document.getElementById('instructions').closest('.form-group').style.display = 'none';
    </script>
</body>
</html>
